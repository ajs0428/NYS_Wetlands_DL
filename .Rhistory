by = join_by(LandscapeClass)) |>
dplyr::mutate(`Model Prediction` = "SOC Perc") |>
dplyr::select(`Model Prediction`, everything()) |>
dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2)))
stat_table_format <- stock_mods_table |>
rbind(#stock_mods_table_noWIP,
Cperc_mods_table)  |>
flextable_fun() |>
merge_v(j = 1) |>
separate_header(split = "[\\.]", fixed = F) |>
flextable::compose(part = "body", i=c(2:3,5:6), j = c(3:4, 7:8),
value = c(as_paragraph("---")  )) |>
align(align = "center", part =  "header") |>
vline(part = "header",  j = 6)|>
flextable::compose(part = "header", i=1, j = 2,
value = c(as_paragraph("Landscape \nClass")  )) |>
flextable::compose(part = "header", i = 2, j = 3,
value = c(as_paragraph("Marginal R", as_sup("2"),
"\n"))) |>
flextable::compose(part = "header", i = 2, j = 4,
value = c(as_paragraph("Conditional R", as_sup("2"),
"\n"))) |>
flextable::compose(part = "header", i = 2, j = 5,
value = c(as_paragraph("Test R", as_sup("2")))) |>
flextable::compose(part = "header", i = 2, j = 6,
value = c(as_paragraph("Test RMSE", (" \ng cm"), as_sup("-2")))) |>
flextable::compose(part = "header", i = 2, j = 7,
value = c(as_paragraph("OOB R", as_sup("2"),
"\n"))) |>
flextable::compose(part = "header", i = 2, j = 8,
value = c(as_paragraph("OOB RMSE", (" \ng cm"), as_sup("-2")))) |>
flextable::compose(part = "header", i = 2, j = 9,
value = c(as_paragraph("Test R", as_sup("2")))) |>
flextable::compose(part = "header", i = 2, j = 10,
value = c(as_paragraph("Test RMSE", (" \ng cm"), as_sup("-2")))) |>
flextable::compose(part = "body", i = 4, j = 1,
value = c(as_paragraph("SOC \n%"))) |>
flextable::compose(part = "body", i = 1, j = 1,
value = c(as_paragraph("SOC stock", "\ng cm", as_sup("-2")))) |>
fix_border_issues()
# vline(part = "header",  j = 9) |>
# delete_rows(i = c(2, 3), part = "body") |>
# delete_columns(j = 1) |>
# flextable::merge_h_range(i = 1, j1 = 1, j2 = 5, part = "header") |>
# flextable::merge_h_range(i = 1, j1 = 6, j2 = 8, part = "header") |>
# flextable::merge_h_range(i = 1, j1 = 9, j2 = 11, part = "header") |>
stat_table_format
saveRDS(stat_table_format, file = "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/Model_stats_table.rds")
readRDS(file = "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/Model_stats_table.rds")
theme_param <- theme(
text = element_text(size = 8),
legend.position = 'right',
legend.key.size = unit(0.6, "cm"),
legend.spacing.x = unit(1.2, "cm"),
legend.text = element_text(size = rel(0.70), hjust = 0.5),
panel.background = element_blank(),
panel.grid.major = element_line(colour = "grey80", linewidth = 0.2),
axis.ticks = element_blank(),
axis.text = element_text(size = rel(0.8)),
axis.title = element_text(size = rel(1))
)
est_func <- function(data, coef_string){
if(str_detect(deparse(substitute(data)), "stocks")){
dat_type <- "stocks"
} else {
dat_type <- "lab"
}
coef <- data[data$Predictor == coef_string, "Coefficient"]
est_2.5 <- data[data$Predictor == coef_string, "conf2.5"]
est_97.5 <- data[data$Predictor == coef_string, "conf.975"]
est_string <- paste0("scaled coefficient estimate = ",
coef, " 95% CI: ",
est_2.5, " - ", est_97.5)
print(est_string)
saveRDS(est_string, paste0("/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/in_text_values/",
coef_string, "_", dat_type, "_est.rds"))
}
for(i in anova_ci_stocks$Predictor){
est_func(anova_ci_stocks, i)
#print(i)
}
for(i in anova_ci_lab$Predictor){
est_func(anova_ci_lab, i)
#print(i)
}
PNW_WIPimp_plot <- ggplot(allsite_WIPimp, aes(x = Predictor, y = MeanDecreaseAccuracy)) +
geom_col() +
facet_wrap(~ StudyArea) +
coord_flip() +
ylab("Mean Decrease Accuracy") +
theme_param
PNW_WIPimp_plot
saveRDS(PNW_WIPimp_plot, "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Figures/PNW_WIPimp_plot.rds")
PNW_WIPimp_plot <- ggplot(allsite_WIPimp, aes(x = Predictor, y = MeanDecreaseAccuracy)) +
geom_col() +
facet_wrap(~ StudyArea) +
coord_flip() +
ylab("Mean Decrease Accuracy") +
theme_param
PNW_WIPimp_plot
saveRDS(PNW_WIPimp_plot, "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Figures/PNW_WIPimp_plot.rds")
for(i in anova_ci_stocks$Predictor){
est_func(anova_ci_stocks, i)
#print(i)
}
predict_plot <- function(model, data) {
mod_string <- tolower(deparse(substitute(model)))
if(str_detect(mod_string, pattern = "lmm")) {
fit_vals <- 10**predict(model, data, allow.new.levels = TRUE)
dep_var <- all.vars(formula(model))[1]
WIP_vals <- data$WIP*sd(train$WIP) + mean(train$WIP)
} else if(str_detect(mod_string, pattern = "rf")){
fit_vals <- predict(model, data)
dep_var <- model$model$dependent.variable.name
WIP_vals <- data$WIP
}
if(str_detect(dep_var, pattern = "carbon_perc")){
xlabel <- "Observed SOC (%)"
ylabel <- "Predicted SOC (%)"
axis_max <- floor(max(fit_vals, data[,1])*1.2)
} else if(str_detect(dep_var, pattern = "SOC_stock_spline")){
xlabel <- expression(Observed~SOC~g~cm^{"-2"})
ylabel <- expression(Predicted~SOC~g~cm^{"-2"})
axis_max <- floor(max(fit_vals, data[,1])*1.2)
}
#Graphing
predict_graph <- ggplot(data = data) +
geom_point(aes(y = fit_vals,
x = .data[[dep_var]],
fill = WIP_vals),
shape = 21, size = 3.5) +
geom_abline(intercept = 0, slope = 1) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(n = 9, name = "YlGnBu"),
values = c(-0.1,1.1), breaks = c(0.01, 0.5, 0.99),
labels = c("0%", "50%", "100%"),
name = "Wetland \nIntrinsic \nPotential",
) +
# annotate(geom = "text", x = axis_max/2, y = axis_max,
#          label = as.expression(bquote(R^2 == .(R2)))) +
ylab(ylabel) +
xlab(xlabel) +
xlim(0, axis_max) +
ylim(0, axis_max) +
theme_param
return(predict_graph)
}
lmm_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = 10**predict(lmm_lab, testlab_scale,
allow.new.levels = TRUE)), 2), nsmall = 2)
qrf_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = predict(QRFM_lab, testlab)), 2) , nsmall = 2)
lmm_stocks_r2 <- format(round(r.sq(y = test_dat_scale$SOC_stock_spline,
y.fitted = 10**predict(lmm_stocks, test_dat_scale,
allow.new.levels = TRUE)), 2), nsmall = 2)
qrf_stocks_r2 <- format(round(r.sq(y = test$SOC_stock_spline,
y.fitted = predict(QRFM_stocks, test)), 2), nsmall = 2)
lmm_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = 10**predict(lmm_lab, testlab_scale,
allow.new.levels = TRUE)), 2), nsmall = 2)
lmm_lab_r2
qrf_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = predict(QRFM_lab, testlab)), 2) , nsmall = 2)
qrf_lab_r2
lmm_stocks_r2 <- format(round(r.sq(y = test_dat_scale$SOC_stock_spline,
y.fitted = 10**predict(lmm_stocks, test_dat_scale,
allow.new.levels = TRUE)), 2), nsmall = 2)
lmm_stocks_r2
qrf_stocks_r2
qrf_stocks_r2 <- format(round(r.sq(y = test$SOC_stock_spline,
y.fitted = predict(QRFM_stocks, test)), 2), nsmall = 2)
qrf_stocks_r2
qrf_stocks_r2 <- format(round(r.sq(y = test$SOC_stock_spline,
y.fitted = predict(QRFM_stocks, test)), 2), nsmall = 2)
QRFM_stocks
predict(QRFM_stocks, test)
test
#| fig-width: 6.5
#| fig-height: 5
lmm_lab_plot <- predict_plot(model = lmm_lab,
data = testlab_scale) +
annotate(geom = "text", x = 6, y = 9,
label = as.expression(bquote(R^2 == .(lmm_lab_r2)))) +
theme(legend.position = "none")
lmm_stocks_plot <- predict_plot(model = lmm_stocks, data = test_dat_scale) +
annotate(geom = "text", x = 1.3, y = 1.8,
label = as.expression(bquote(R^2 == .(lmm_stocks_r2))))
qrf_stocks_plot <- predict_plot(model = QRFM_stocks, data = test) +
annotate(geom = "text", x = 1.3, y = 1.8,
label = as.expression(bquote(R^2 == .(qrf_stocks_r2))))
test <- read.csv("/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/data/dataframes/Test_data.csv") |>
dplyr::select(-site, -X, ) |> dplyr::mutate(across(where(is.character), as.factor))
test
library(formatR)
knitr::opts_chunk$set(echo = TRUE, fig.align = "center", fig.show = "hold", time_it = TRUE, dpi = 100, message = FALSE, warning = FALSE)
knitr::opts_chunk$set(tidy.opts = list(width.cutoff = 60), tidy = T, collapse = TRUE)
knitr::opts_knit$set(root.dir = '/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/')
library(tidyverse)
library(terra)
library(mlr3verse)
library(mlr3spatial)
library(tidyr)
set.seed(11)
hlef_dat <- data.frame(vect("SOIL CARBON/All_WA/data/points/hlef_pts_6394.gpkg"))
hoh_dat <- data.frame(vect("SOIL CARBON/All_WA/data/points/hoh_pts_2855.gpkg")) #|>
mas_dat <- data.frame(vect("SOIL CARBON/All_WA/data/points/mas_pts_2856.gpkg")) #|>
col_dat <- data.frame(vect("SOIL CARBON/All_WA/data/points/col_pts_2855.gpkg")) #|>
pnw_dat <- rbind(hoh_dat, mas_dat, col_dat) |>
select(names(hlef_dat)) |>
rbind(hlef_dat) |>
mutate(across(where(is.character),  as.factor),
site = fct_reorder(site, SOC_stock_spline, .fun = "median"),
PET_MAP = PET/MAP,
#SOC_stock_spline = log10(SOC_stock_spline)
) |>
dplyr::rename_with(~gsub("_median", "", .x, fixed = TRUE)) |>
dplyr::select(SOC_stock_spline, sample_ID, site, lower_depth,
WIP, MAP, LITH, nlcd_reclass, PET_MAP,
MAT, CHM, HLI, EVI, NDVI, DTM, geomorphons,
dev_1000, dev_300, dev_50,
grad_1000, grad_300, grad_50)
pnw_dat
readr::write_csv(pnw_dat, "SOIL CARBON/All_WA/data/dataframes/PNW_data_MLR3_RFM_LMM.csv")
hlef_lab_dat <- data.frame(vect("SOIL CARBON/All_WA/data/points/hlef_lab_pts_6394.gpkg"))
hoh_lab_pts <- data.frame(vect("SOIL CARBON/All_WA/data/points/hoh_lab_pts_2855.gpkg"))
mas_lab_pts <- data.frame(vect("SOIL CARBON/All_WA/data/points/mas_lab_pts_2856.gpkg"))
col_lab_pts <- data.frame(vect("SOIL CARBON/All_WA/data/points/col_lab_pts_2855.gpkg"))
pnw_dat_lab <- rbind(hoh_lab_pts, mas_lab_pts, col_lab_pts) |>
select(names(hlef_lab_dat)) |>
rbind(hlef_lab_dat) |>
dplyr::filter(!is.na(pH)) |>
mutate(
across(where(is.character),  as.factor),
site = fct_reorder(site, carbon_perc, .fun = "median"),
PET_MAP = PET/MAP) |>
dplyr::rename_with(~gsub("_median", "", .x, fixed = TRUE)) |>
dplyr::select(carbon_perc, sample_ID, site, lower_depth,
WIP, MAP, LITH, nlcd_reclass, PET_MAP,
MAT, CHM, HLI, EVI, NDVI, DTM, geomorphons,
pH, Sand, Silt, Clay, SiltClay,
dev_1000, dev_300, dev_50,
grad_1000, grad_300, grad_50)
pnw_dat_lab
readr::write_csv(pnw_dat_lab, "SOIL CARBON/All_WA/data/dataframes/PNW_Lab_data_MLR3_RFM_LMM.csv")
set.seed(11)
training_portion <- 0.85
stocks_tsk <- as_task_regr(pnw_dat, target = "SOC_stock_spline", id = "stocks")
stocks_tsk$col_roles$group = c("sample_ID")
split <- partition(stocks_tsk, ratio = training_portion)
train <- pnw_dat[split$train,]
test <- pnw_dat[-split$train,]
train.wet <- pnw_dat[split$train,] |> filter(WIP >= 0.5)
test.wet <- pnw_dat[-split$train,] |> filter(WIP >= 0.5)
train.upl <- pnw_dat[split$train,] |> filter(WIP < 0.5)
test.upl <- pnw_dat[-split$train,] |> filter(WIP < 0.5)
nrow(train)
nrow(test)
train |> group_by(site) |> summarise(n = n())
test |> group_by(site) |> summarise(n = n())
write.csv(pnw_dat, "SOIL CARBON/All_WA/data/dataframes/PNW_data_MLR3_RFM_LMM.csv")
write.csv(test, "SOIL CARBON/All_WA/data/dataframes/Test_data.csv")
write.csv(train, "SOIL CARBON/All_WA/data/dataframes/Train_data.csv")
write.csv(test.wet, "SOIL CARBON/All_WA/data/dataframes/RFM_Test_Wet_data.csv")
write.csv(test.upl, "SOIL CARBON/All_WA/data/dataframes/RFM_Test_Upl_data.csv")
lab_tsk <- as_task_regr(pnw_dat_lab, target = "carbon_perc", id = "lab")
lab_tsk$col_roles$group = "sample_ID"
split_lab <- partition(lab_tsk, ratio = 0.85)
trainlab <- pnw_dat_lab[split_lab$train,]
testlab <- pnw_dat_lab[-split_lab$train,]
trainlab.wet <- pnw_dat_lab[split_lab$train,] |> filter(WIP >= 0.5)
testlab.wet <- pnw_dat_lab[-split_lab$train,] |> filter(WIP >= 0.5)
trainlab.upl <- pnw_dat_lab[split_lab$train,] |> filter(WIP < 0.5)
testlab.upl <- pnw_dat_lab[-split_lab$train,] |> filter(WIP < 0.5)
nrow(trainlab)
nrow(testlab)
write.csv(pnw_dat_lab, "SOIL CARBON/All_WA/data/dataframes/PNW_Lab_data_MLR3_RFM_LMM.csv")
write.csv(testlab, "SOIL CARBON/All_WA/data/dataframes/Test_Lab_data.csv")
write.csv(trainlab, "SOIL CARBON/All_WA/data/dataframes/Train_Lab_data.csv")
write.csv(testlab.wet, "SOIL CARBON/All_WA/data/dataframes/RFM_Test_Lab_Wet_data.csv")
write.csv(testlab.upl, "SOIL CARBON/All_WA/data/dataframes/RFM_Test_Lab_Upl_data.csv")
scale_fun <- function(traindf, scaledf, target, wip) {
train_means <- traindf |> summarise(across(
dplyr::where(is.numeric) & !all_of(target),
~ dplyr::case_when(TRUE ~ mean(.))))
train_sd <- traindf |> summarise(across(
dplyr::where(is.numeric) & !all_of(target),
~ dplyr::case_when(TRUE ~ sd(.))))
train_scale_params <- rbind(train_means, train_sd) |> t() |>
data.frame() |>
tibble::rownames_to_column(var = "Parameter") |>
rename("Mean" = "X1",
"SD" = "X2")
if(tolower(wip) == "wet"){
scaled_df <- scaledf |>
filter(WIP >= 0.50) |>
dplyr::mutate(across(all_of(train_scale_params$Parameter), ~
(.x - train_scale_params$Mean[match(cur_column(),
train_scale_params$Parameter)])/
train_scale_params$SD[match(cur_column(),
train_scale_params$Parameter)]))
} else if(tolower(wip) == "upl") {
scaled_df <- scaledf |>
filter(WIP < 0.50) |>
mutate(across(all_of(train_scale_params$Parameter), ~
(.x - train_scale_params$Mean[match(cur_column(),
train_scale_params$Parameter)])/
train_scale_params$SD[match(cur_column(),
train_scale_params$Parameter)]))
} else {
scaled_df <- scaledf |>
mutate(across(all_of(train_scale_params$Parameter), ~
(.x - train_scale_params$Mean[match(cur_column(),
train_scale_params$Parameter)])/
train_scale_params$SD[match(cur_column(),
train_scale_params$Parameter)]))
}
return(scaled_df)
}
train_scale <- scale_fun(traindf = train, scaledf = train,
target = "SOC_stock_spline", wip = "all")
train_wet_scale <- scale_fun(traindf = train, scaledf = train,
target = "SOC_stock_spline", wip = "wet")
train_upl_scale <- scale_fun(traindf = train, scaledf = train,
target = "SOC_stock_spline", wip = "upl")
test_scale <- scale_fun(traindf = train, scaledf = test,
target = "SOC_stock_spline", wip = "all")
test_wet_scale <- scale_fun(traindf = train, scaledf = test,
target = "SOC_stock_spline", wip = "wet")
test_upl_scale <- scale_fun(traindf = train, scaledf = test,
target = "SOC_stock_spline", wip = "upl")
write_csv(train_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Stocks_Train_Scale.csv")
write_csv(train_wet_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Stocks_Train_Wet_Scale.csv")
write_csv(train_upl_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Stocks_Train_Upl_Scale.csv")
write_csv(test_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Stocks_Test_Scale.csv")
write_csv(test_wet_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Stocks_Test_Wet_Scale.csv")
write_csv(test_upl_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Stocks_Test_Upl_Scale.csv")
trainlab_scale <- scale_fun(traindf = trainlab, scaledf = trainlab,
target = "carbon_perc", wip = "all")
trainlab_wet_scale <- scale_fun(traindf = trainlab, scaledf = trainlab,
target = "carbon_perc", wip = "wet")
trainlab_upl_scale <- scale_fun(traindf = trainlab, scaledf = trainlab,
target = "carbon_perc", wip = "upl")
testlab_scale <- scale_fun(traindf = trainlab, scaledf = testlab,
target = "carbon_perc", wip = "all")
testlab_wet_scale <- scale_fun(traindf = trainlab, scaledf = testlab,
target = "carbon_perc", wip = "wet")
testlab_upl_scale <- scale_fun(traindf = trainlab, scaledf = testlab,
target = "carbon_perc", wip = "upl")
write_csv(trainlab_scale ,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Lab_Train_Scale.csv")
write_csv(trainlab_wet_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Lab_Train_Wet_Scale.csv")
write_csv(trainlab_upl_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Lab_Train_Upl_Scale.csv")
write_csv(testlab_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Lab_Test_Scale.csv")
write_csv(testlab_wet_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Lab_Test_Wet_Scale.csv")
write_csv(testlab_upl_scale,
file = "SOIL CARBON/All_WA/data/dataframes/PNW_Spline_Lab_Test_Upl_Scale.csv")
hist(test$SOC_stock_spline)
hist(train$SOC_stock_spline)
train |> group_by(geomorphons) |>
#filter(WIP > 0.5) |>
summarise(mean=mean(SOC_stock_spline)) |>
ggplot(aes(x = geomorphons, y = mean)) + geom_col()
library(lme4)
library(lmerTest)
d <- (runif(100, min = -3, 40))
p1 <- rnorm(100,mean = 10, sd = 5)
p2 <- rnorm(100, mean = 30, sd = 25)
p3 <- rep(c("w1", "w2", "w3", "w4"), 25)
dat <- data.frame(cbind(d, p1, p2, p3))
names(dat)
mod <- lm(d ~ p1 , data = dat)
mod
summary(mod)
dat <- data.frame(cbind(d, p1, p2, as.factor(p3)))
names(dat)
dat <- data.frame(cbind(d, p1, p2, p3 = as.factor(p3)))
names(dat)
mod <- lm(d ~ p1 , data = dat)
summary(mod)
dat
mod <- lm(d ~ p1 + p3, data = dat)
summary(mod)
gmod <- glm(d ~ p1 + p3, data = dat, family = Gamma(link = "log"))
gmod <- glm(d ~ p1 + p3, data = dat, family = Gamma(link = "inverse"))
?family
hist(d)
hist(d^(1/3))
hist(log(d^(1/3)))
hist(log10(d^(1/3)))
hist(d^(2/3))
qqplot(dat$d)
?qqplot
qqnorm(dat$d)
r
mod <- lm(d ~ p1 + p3, data = dat)
summary(mod)
mod <- lmer(d ~ p1 + (1|p3), data = dat)
mod <- lmer(d ~ p1 + p2 + (1|p3), data = dat)
summary(mod)
ch4 <- readxl::read_xlsx("FieldData/CH4_flux_combined_2023_2024.xlsx", sheet = )
ch4 <- readxl::read_xlsx("FieldData/CH4_flux_combined_2023_2024.xlsx", sheet = 1)
readxl::read_xlsx("FieldData/veg_cover_combined_2023_2024_only_1m_x_1m.xlsx", sheet = 1)
veg <- readxl::read_xlsx("FieldData/veg_cover_combined_2023_2024_only_1m_x_1m.xlsx", sheet = 1)
ch4
dat <- ch4 |> left_join(y = veg, by = join_by(Unique_ID))
library(dplyr)
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID))
dat
veg
ch4
dat$CH4_mmol_hr_m2
hist(dat$CH4_mmol_hr_m2)
hist((dat$CH4_mmol_hr_m2)**(1/3))
hist((dat$CH4_mmol_hr_m2)**(1/5))
hist((dat$CH4_mmol_hr_m2)**(1/7))
hist((dat$CH4_mmol_hr_m2)**(1/9))
hist((dat$CH4_mmol_hr_m2)**(1/3))
hist((dat$CH4_mmol_hr_m2)**(1/5))
hist((dat$CH4_mmol_hr_m2)**(1/7))
hist((dat$CH4_mmol_hr_m2)**(1/9))
hist((dat$CH4_mmol_hr_m2)**(1/11))
names(dat)
glimpse(dat)
unique(dat$Woody_cover)
unique(dat$FWD)
unique(dat$Graminoids)
unique(dat$Emergent)
hist(dat$Emergent)
plot(dat$Emergent)
plot(dat$CH4_mmol_hr_m2 ~ dat$Emergent)
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(where(is.character) ~ as.factor(.))
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(where(is.character) ~ as.factor())
mutate(where(is.character) ~ as.factor
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(where(is.character) ~ as.factor)
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(where(is.character(.)) ~ as.factor(.))
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(across(where(is.character(.))) ~ as.factor(.))
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(across(where(is.character) ~ as.factor))
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(across(everything(), where(is.character) ~ as.factor))
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(across(where(is.character) ~ as.factor(.)))
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(across(where(is.character) ~ as.factor(.x)))
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(across(where(is.character), ~ as.factor))
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(across(where(is.character), ~ as.factor(.x)))
dat
plot(dat$CH4_mmol_hr_m2 ~ dat$Graminoids)
dat <- ch4 |> dplyr::left_join(y = veg, by = join_by(Unique_ID)) |>
mutate(across(where(is.character), ~ as.factor(.x)),
Graminoids = case_when(Graminoids == ">75" ~ 100,
Graminoids == "51-75" ~ 75,
Graminoids == "26-50" ~ 50,
Graminoids == "6-25" ~ 25,
Graminoids == "1-5" ~ 5,
Graminoids == "0" ~ 0,
.default = 0))
dat
plot(dat$CH4_mmol_hr_m2 ~ dat$Graminoids)
mod <- lmer(CH4_mmol_hr_m2**(1/11) ~ Graminoids + Wetland_Type + (1|Site_ID), data = dat)
summary(mod)
mod <- lmer(CH4_mmol_hr_m2**(1/11) ~ Graminoids + Wetland_Type + (1|Site_ID), data = dat, REML = FALSE)
summary(mod)
mod <- lmer(CH4_mmol_hr_m2**(1/11) ~ Graminoids + Wetland_Type + (Collar|Site_ID), data = dat, REML = FALSE)
summary(mod)
mod <- lmer(CH4_mmol_hr_m2**(1/11) ~ Graminoids*Wetland_Type + (1|Site_ID), data = dat, REML = FALSE)
summary(mod)
mod <- lmer(CH4_mmol_hr_m2**(1/11) ~ Graminoids + Ecoregion + (1|Site_ID), data = dat, REML = FALSE)
summary(mod)
mod <- lmer(CH4_mmol_hr_m2**(1/11) ~ Graminoids*Ecoregion + (1|Site_ID), data = dat, REML = FALSE)
summary(mod)
plot(resid(mod), fitted(mod))
plot(resid(mod) ~ fitted(mod))
qqline(mod)
qqline(dat$CH4_mmol_hr_m2)
qqnorm(mod)
?qqnorm
qqnorm(dat$CH4_mmol_hr_m2)
qqnorm(dat$CH4_mmol_hr_m2**(1/11))
qqline(dat$CH4_mmol_hr_m2**(1/11))
#| label: setup
#| message: false
library(formatR)
knitr::opts_chunk$set(echo = TRUE, fig.align = "center", fig.show = "hold", time_it = TRUE, dpi = 150, message = FALSE,
tidy.opts = list(width.cutoff = 60), tidy = T, collapse = TRUE)
knitr::opts_knit$set(root.dir = '/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/')
library(terra)
library(sf)
library(spatialEco)
library(lidR)
library(tidyterra)
library(dplyr)
library(whitebox)
library(MultiscaleDTM)
set.seed(11)
mtcars
