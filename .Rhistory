summarise(site = "All",
mean = mean(SOC_stock_spline),
sd = sd(SOC_stock_spline),
n = n()) |>
mutate(se = sd/sqrt(n),
dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2)))) |>
dplyr::select(site, lower_depth, mean, sd, n, se)
site_depth_stocks <- pnw_dat |> group_by(site) |>
summarise(lower_depth = 0,
mean = mean(SOC_stock_spline),
sd = sd(SOC_stock_spline),
n = n()) |>
mutate(se = sd/sqrt(n),
dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2))))
mean_stdev_stocks_table <- pnw_dat |> group_by(site, lower_depth) |>
summarise(mean = mean(SOC_stock_spline),
sd = sd(SOC_stock_spline),
n = n()) |>
mutate(se = sd/sqrt(n),
dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2)))) |>
bind_rows(overall_depth_stocks) |>
bind_rows(site_depth_stocks) |>
bind_rows(all_sites_depth_stocks) |>
filter(lower_depth <151) |>
mutate(site = case_when(str_detect(site, "(?i)HOH") ~ "HRW",
str_detect(site, "(?i)MAS") ~ "MRW",
str_detect(site, "(?i)COL") ~ "CVW",
str_detect(site, "(?i)HLEF") ~ "HLEF",
.default = "All"),
site = factor(site),
site = fct_relevel(site, c("All", "HLEF", "HRW", "MRW", "CVW"))) |>
arrange(site) |>
rename("Study Area" = site,
"Depth" = lower_depth) |>
dplyr::select(-sd) |>
relocate(`Study Area`, Depth, mean, se, n) |>
flextable_fun() |>
merge_v(j = ~ `Study Area`) |>
mk_par(
part = "header", j = 1,
value = as_paragraph("Study\nArea")
) |>
mk_par(
part = "header", j = 3,
value = as_paragraph("Mean SOC Stock\n(g cm", as_sup("-2"), ")")
) |>
mk_par(
part = "header", j = 4,
value = as_paragraph("Std. Error SOC Stock\n(g cm", as_sup("-2"), ")")
) |>
mk_par(
part = "body", i = c(7,14,21,28,35), j = 2,
value = as_paragraph("Overall")
) |>
hline(part = "body", border = fp_border_default(width =0)) |>
add_body_row(top = FALSE, values = "", colwidths = c( 5)) |>
hline(part = "body", i = c(7,14,21,28)) |>
hline(part = "body", i = 35, border = thick_border) |>
fontsize(size = 10, part = "body", j = 1)
mean_stdev_stocks_table
saveRDS(mean_stdev_stocks_table, file = "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/mean_stdev_stocks_table.rds")
# Chunk 9
percSOC_table <- pnw_dat_lab |> mutate(depth_zone = case_when(lower_depth <= 25 ~ "0-25",
lower_depth > 25 & lower_depth <=50 ~ "25-50",
lower_depth > 50 & lower_depth <=75 ~ "50-75",
lower_depth > 75 & lower_depth <=100 ~ "75-100",
lower_depth > 100 & lower_depth <=125 ~ "100-125",
lower_depth > 125 & lower_depth <=150 ~ "125-150",
.default = " > 150"),
wetupl = case_when(WIP >= 0.50 ~ "wet",
.default = "upl")) |>
group_by(site, wetupl, .drop = TRUE) |>
summarise(mean_percSOC = mean(carbon_perc),
sd_percSOC = sd(carbon_perc),
n = n()) |>
mutate(se_percSOC = sd_percSOC/sqrt(n),
# depth_zone = ordered(depth_zone, levels =
#                                   c("0-25", "25-50","50-75",
#                                     "75-100","100-125", "125-150",
#                                     " > 150")),
site = case_when(str_detect(site, "(?i)HOH") ~ "HRW",
str_detect(site, "(?i)MAS") ~ "MRW",
str_detect(site, "(?i)COL") ~ "CVW",
str_detect(site, "(?i)HLEF") ~ "HLEF",
.default = "All"),
site = as.factor(site),
wetupl = case_when(str_detect(wetupl, "wet") ~ "Wetland",
.default = "Upland"),
dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2)))) |>
dplyr::select(site, wetupl, mean_percSOC, sd_percSOC, se_percSOC, n) |>
mutate(site = fct_relevel(site, c("HLEF", "HRW", "MRW", "CVW"))) |>
dplyr::arrange(site) |>
dplyr::select(-sd_percSOC) |>
flextable_fun() |>
merge_v(j = c(1)) |>
mk_par(
part = "header", j = 1,
value = as_paragraph("Study\nArea")
) |>
mk_par(
part = "header", j = 2,
value = as_paragraph("Landscape\nClass")
) |>
mk_par(
part = "header", j = 3,
value = as_paragraph("Mean\nSOC %")
) |>
# mk_par(
#   part = "header", j = 4,
#   value = as_paragraph("Std. Deviation \nSOC %")
#   ) |>
mk_par(
part = "header", j = 4,
value = as_paragraph("Std. Error \nSOC %")
) |>
hline(part = "body", i = 2, j = 2:5) |>
hline(part = "body", i = 4, j = 2:5) |>
hline(part = "body", i = 6, j = 2:5) |>
hline(part = "body", i = 8, border = thick_border) |>
fix_border_issues()
percSOC_table
saveRDS(percSOC_table, file = "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/SOC_percent_bySite.rds")
# Chunk 11
library(ppcor)
pnw_lab_wet_ppcor <- pnw_dat_lab |> filter(WIP >= 0.50) |>
dplyr::select(carbon_perc, lower_depth, PET_MAP, pH, Clay) |>
ppcor::pcor(method = "spearman")
pnw_lab_upl_ppcor <- pnw_dat_lab |> filter(WIP < 0.50) |>
dplyr::select(carbon_perc, lower_depth, PET_MAP, pH, Clay) |>
ppcor::pcor(method = "spearman")
pnw_wet_ppcor <- pnw_dat |> filter(WIP >= 0.50) |>
dplyr::select(SOC_stock_spline, lower_depth, PET_MAP,
MAT, WIP, CHM, (LITH), (geomorphons)) |>
mutate(LITH = rank(LITH),
geomorphons = rank(geomorphons)) |>
ppcor::pcor(method = "spearman")
pnw_upl_ppcor <- pnw_dat |> filter(WIP < 0.50) |>
dplyr::select(SOC_stock_spline, lower_depth, PET_MAP,
MAT, WIP, CHM, (LITH), (geomorphons)) |>
mutate(LITH = rank(LITH),
geomorphons = rank(geomorphons)) |>
ppcor::pcor(method = "spearman")
ppcor_func <- function(ppcor_df, iv) {
ppcor_col <- ppcor_df$estimate |> data.frame() |> tibble::rownames_to_column(var = "Predictor") |>  tibble::as_tibble() |> dplyr::select(Predictor, !!iv)
return(ppcor_col)
}
wetlab_ppcor <- ppcor_func(pnw_lab_wet_ppcor, "carbon_perc")
upllab_ppcor <- ppcor_func(pnw_lab_upl_ppcor, "carbon_perc")
wet_ppcor <- ppcor_func(pnw_wet_ppcor, "SOC_stock_spline")
upl_ppcor <- ppcor_func(pnw_upl_ppcor, "SOC_stock_spline")
all_lab_ppor <- wetlab_ppcor |> rename(carbon_perc_wet = carbon_perc) |> left_join(upllab_ppcor, by = join_by(Predictor)) |> rename(carbon_perc_upl = carbon_perc) |> filter(Predictor != "carbon_perc")
all_ppor <- wet_ppcor |> rename(SOC_stock_spline_wet = SOC_stock_spline) |> left_join(upl_ppcor, by = join_by(Predictor)) |> rename(SOC_stock_spline_upl = SOC_stock_spline) |> filter(Predictor != "SOC_stock_spline")
# Chunk 12
all_lab_ppor_ft <- all_lab_ppor |>
mutate_tab() |>
mutate(dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2)))) |>
flextable_fun() |>
mk_par(
part = "header", j = 2,
value = as_paragraph("SOC %", "\nWetland (WIP ≥ 50%)")
) |>
mk_par(
part = "header", j = 3,
value = as_paragraph("SOC %", "\nUpland (WIP < 50%)")
)
all_ppor_ft <- all_ppor |>
mutate_tab() |>
mutate(dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2)))) |>
flextable_fun() |>
mk_par(
part = "header", j = 2,
value = as_paragraph("SOC Stock (g cm", as_sup("-2"), ")", "\nWetland (WIP ≥ 50%)")
) |>
mk_par(
part = "header", j = 3,
value = as_paragraph("SOC Stock (g cm", as_sup("-2"), ")", "\nUpland (WIP < 50%)")
)
saveRDS(all_lab_ppor_ft, "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/all_lab_ppor_ft.rds")
saveRDS(all_ppor_ft, "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/all_ppor_ft.rds")
# Chunk 13
PNW_Mapped_SOC <- PNW_SOC_df |>
#bind_rows(gsoc_frac_pnw) |>
bind_rows(ensemble_SOC) |>
#bind_rows(mcnicol_soc_frac_form) |>
mutate(StudyArea = case_when(str_detect(StudyArea, "(?i)HOH") ~ "HRW",
str_detect(StudyArea, "(?i)MAS") ~ "MRW",
str_detect(StudyArea, "(?i)COL") ~ "CVW",
str_detect(StudyArea, "(?i)HLEF") ~ "HLEF",
.default = NA)) |>
bind_rows(y = nwca_soc_est) |>
mutate(Source = case_when(str_detect(Name, "(?i)ensemble") ~ "Ensemble Model",
str_detect(Name, "(?i)mcnicol") ~ "McNicol et al., 2019",
str_detect(Name, "(?i)nwca") ~ "Uhran et al., 2021",
.default = "This Study")) |>
mutate(Name = case_when(#str_detect(Name, "(?i)list") ~ "Total",
str_detect(Name, "(?i)nwca") ~ "Wetland",
str_detect(Name, "(?i)_wet") ~ "Wetland",
str_detect(Name, "(?i)_upl") ~ "Upland",
.default = "Total")) |>
dplyr::arrange(match(Name, c("Total", "Wetland", "Upland")),
match(StudyArea, c("HLEF", "HRW", "MRW", "CVW"))) |>
dplyr::select( Name, StudyArea, Source, everything()) |>
dplyr::select(-Perc10thSOC_Mgha, -Perc90thSOC_Mgha) |>
dplyr::mutate(across(where(is.numeric), ~ case_when(
. > 100  ~ round(., 0),  # Round to the nearest hundred
#. > 100 & . <= 1000 ~ round(., 0),  # Round to the nearest ten
. > 10 & . <= 100 ~ round(., 1),
. > 0 & . <= 10  ~ round(., 2),  # Round to the nearest whole number
TRUE ~ .  # Default case (if needed)
))) |>
flextable_fun() |>
compose(part = "header", i=1, j = 1,
value = c(as_paragraph("Landscape \nClass")  )) |>
compose(part = "header", i=1, j = 2,
value = c(as_paragraph("Study\nArea")  )) |>
compose(part = "header", i=1, j = 4,
value = c(as_paragraph("Total \nArea\n(ha)")  )) |>
compose(part = "header", i=1, j = 5,
value = c(as_paragraph("Mean 1m \nSOC Stock\n",
"(Mg ha", as_sup("-1"), ")"))) |>
compose(part = "header", i=1, j = 6,
value = c(as_paragraph("Total 1m\nSOC Stock\n(Tg)")  )) |>
merge_v(j = c(1,2)) |>
hline(part = "body", i = 8) |>
hline(part = "body", i = 19) |>
#hline(part = "body", i = 27) |>
hline(part = "body", i = 2, j = 2:6) |>
hline(part = "body", i = 4, j = 2:6) |>
hline(part = "body", i = 6, j = 2:6) |>
hline(part = "body", i = 10, j = 2:6) |>
hline(part = "body", i = 13, j = 2:6) |>
hline(part = "body", i = 16, j = 2:6) |>
hline(part = "body", i = 21, j = 2:6) |>
hline(part = "body", i = 23, j = 2:6) |>
hline(part = "body", i = 25, j = 2:6) |>
#hline(part = "body", i = 28, j = 2:6) |>
fix_border_issues()
PNW_Mapped_SOC
saveRDS(PNW_Mapped_SOC, "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/PNW_Mapped_SOC.rds")
# Chunk 14
mappedSOC_025_1m_depths_sum_df <- read.csv("/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/data/dataframes/PNW_mappedSOC_025_1m_depths_sum_df.csv") |>  mutate(across(contains("SOC"), ~ . * 100))
mappedSOC_975_1m_depths_sum_df <- read.csv("/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/data/dataframes/PNW_mappedSOC_975_1m_depths_sum_df.csv") |>  mutate(across(contains("SOC"), ~ . * 100))
uncertainty_table_mapped_SOC <- mappedSOC_025_1m_depths_sum_df |>
dplyr::select(-Perc10thSOC_Mgha, -Perc90thSOC_Mgha) |>
rename(Perc025_AverageSOC_Mgha = AverageSOC_Mgha,
Perc025_Total_SOC_Tg = Total_SOC_Tg) |>
cbind(mappedSOC_975_1m_depths_sum_df[,c("AverageSOC_Mgha", "Total_SOC_Tg")]) |>
rename(Perc975_AverageSOC_Mgha = AverageSOC_Mgha,
Perc975_Total_SOC_Tg = Total_SOC_Tg)  |>
mutate(StudyArea = case_when(str_detect(StudyArea, "(?i)HOH") ~ "HRW",
str_detect(StudyArea, "(?i)MAS") ~ "MRW",
str_detect(StudyArea, "(?i)COL") ~ "CVW",
str_detect(StudyArea, "(?i)HLEF") ~ "HLEF",
.default = NA)) |>
mutate(Name = case_when(#str_detect(Name, "(?i)list") ~ "Total",
str_detect(Name, "(?i)_wet") ~ "Wetland",
str_detect(Name, "(?i)_upl") ~ "Upland",
.default = "Total")) |>
dplyr::arrange(match(Name, c("Total", "Wetland", "Upland")),
match(StudyArea, c("HLEF", "HRW", "MRW", "CVW"))) |>
dplyr::mutate(across(where(is.numeric), ~ case_when(
. > 100  ~ round(., 0),  # Round to the nearest hundred
#. > 100 & . <= 1000 ~ round(., 0),  # Round to the nearest ten
. > 10 & . <= 100 ~ round(., 1),
. > 0 & . <= 10  ~ round(., 2),  # Round to the nearest whole number
TRUE ~ .  # Default case (if needed)
))) |>
mutate(Perc95th_AverageSOC_Mgha = paste0(Perc025_AverageSOC_Mgha, " - ", Perc975_AverageSOC_Mgha),
Perc95th_TotalSOC_Tg = paste0(Perc025_Total_SOC_Tg, " - ", Perc975_Total_SOC_Tg)) |>
dplyr::select(Name, StudyArea, Total_area, Perc95th_AverageSOC_Mgha, Perc95th_TotalSOC_Tg) |>
flextable_fun() |>
compose(part = "header", i=1, j = 1,
value = c(as_paragraph("Landscape \nClass")  )) |>
compose(part = "header", i=1, j = 2,
value = c(as_paragraph("Study\nArea")  )) |>
compose(part = "header", i=1, j = 3,
value = c(as_paragraph("Total \nArea (ha)")  )) |>
compose(part = "header", i=1, j = 4,
value = c(as_paragraph("95% Prediction Interval\nMean 1m SOC Stock\n",
("Mg ha"), as_sup("-1")))) |>
compose(part = "header", i=1, j = 5,
value = c(as_paragraph("95% Prediction Interval\nTotal 1m SOC Stock \n(Tg)")  )) |>
merge_v(j = c(1,2)) |>
hline(part = "body", i = 4, j = 2:5) |>
hline(part = "body", i = 8, j = 2:5) |>
fix_border_issues()
uncertainty_table_mapped_SOC
saveRDS(uncertainty_table_mapped_SOC, "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/PNW_Uncertainty_Mapped_SOC.rds")
# Chunk 15
NWI_areas_df <- read.csv("/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/data/dataframes/PNW_NWI_wetland_areas.csv")
PNW_Wet_Area <- PNW_SOC_df |> dplyr::filter(Name == "list_wet") |> dplyr::select(StudyArea, Total_area) |>
dplyr::mutate(StudyArea = str_replace_all(StudyArea, c(hlef_soc = "HLEF",
hoh_soc = "HRW",
mas_soc = "MRW",
col_soc = "CVW"))) |>
left_join(NWI_areas_df, by = join_by(StudyArea)) |>
dplyr::mutate(Perc_change = ((Total_area - NWI_wet_ha)/NWI_wet_ha)*100,
across(where(is.numeric), ~ case_when(
. > 100  ~ round(., 0),  # Round to the nearest hundred
. > 100 & . <= 1000 ~ round(., 0),  # Round to the nearest ten
. > 10 & . <= 100 ~ round(., 1),
. > 0 & . <= 10  ~ round(., 2),  # Round to the nearest whole number
TRUE ~ .  # Default case (if needed)
)))
PNW_Wet_Area_Table <- PNW_Wet_Area |>
#dplyr::mutate(Perc_change = paste0(Perc_change, " %")) |>
flextable_fun() |>
compose(part = "header", i=1, j = 1,
value = c(as_paragraph("Study\nArea"))) |>
compose(part = "header", i=1, j = 2,
value = c(as_paragraph("WIP Wetland\nArea (ha)")  )) |>
compose(part = "header", i=1, j = 3,
value = c(as_paragraph("NWI Wetland\nArea (ha)")  )) |>
compose(part = "header", i=1, j = 4,
value = c(as_paragraph("% Change\n(WIP-NWI)/NWI")  ))
PNW_Wet_Area_Table
saveRDS(PNW_Wet_Area_Table, "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/PNW_Wet_Area_Table.rds")
# Chunk 16
stock_mods_table <- mod_errdf |>
dplyr::select(LandscapeClass, LMM.LogMargR2, LMM.LogCondR2,
LMM.nLogPredObsR2, LMM.nlogPredObsRMSE) |>
left_join(y = qrf_errdf |>
dplyr::select(LandscapeClass, RFM.R2_OOB, RFM.RMSE_OOB,
RFM.R2_test, RFM.RMSE_test),
by = join_by(LandscapeClass)) |>
dplyr::mutate(`Model Prediction` = "SOC Stock") |>
dplyr::select(`Model Prediction`, everything()) |>
dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2)))
stock_mods_table_noWIP <- mod_errdf_noWIP |>
dplyr::select(LandscapeClass, LMM.LogMargR2, LMM.LogCondR2,
LMM.nLogPredObsR2, LMM.nlogPredObsRMSE) |>
left_join(y = qrf_errdf_noWIP |>
dplyr::select(LandscapeClass, RFM.R2_OOB, RFM.RMSE_OOB,
RFM.R2_test, RFM.RMSE_test),
by = join_by(LandscapeClass)) |>
dplyr::mutate(`Model Prediction` = "SOC Stock") |>
dplyr::select(`Model Prediction`, everything()) |>
dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2)))
Cperc_mods_table <- mod_errdf_lab |>
dplyr::select(LandscapeClass, LMM.LogMargR2, LMM.LogCondR2,
LMM.nLogPredObsR2, LMM.nlogPredObsRMSE) |>
left_join(y = qrf_errdf_lab|>
dplyr::select(LandscapeClass, RFM.R2_OOB, RFM.RMSE_OOB,
RFM.R2_test, RFM.RMSE_test),
by = join_by(LandscapeClass)) |>
dplyr::mutate(`Model Prediction` = "SOC Perc") |>
dplyr::select(`Model Prediction`, everything()) |>
dplyr::mutate(across(where(is.numeric), ~base::round(.x, 2)))
stat_table_format <- stock_mods_table |>
rbind(#stock_mods_table_noWIP,
Cperc_mods_table)  |>
flextable_fun() |>
merge_v(j = 1) |>
separate_header(split = "[\\.]", fixed = F) |>
compose(part = "body", i=c(2:3,5:6), j = c(3:4, 7:8),
value = c(as_paragraph("---")  )) |>
align(align = "center", part =  "header") |>
vline(part = "header",  j = 6)|>
compose(part = "header", i=1, j = 2,
value = c(as_paragraph("Landscape \nClass")  )) |>
compose(part = "header", i = 2, j = 3,
value = c(as_paragraph("Marginal R", as_sup("2"),
"\n"))) |>
compose(part = "header", i = 2, j = 4,
value = c(as_paragraph("Conditional R", as_sup("2"),
"\n"))) |>
compose(part = "header", i = 2, j = 5,
value = c(as_paragraph("Test R", as_sup("2")))) |>
compose(part = "header", i = 2, j = 6,
value = c(as_paragraph("Test RMSE", (" \ng cm"), as_sup("-2")))) |>
compose(part = "header", i = 2, j = 7,
value = c(as_paragraph("OOB R", as_sup("2"),
"\n"))) |>
compose(part = "header", i = 2, j = 8,
value = c(as_paragraph("OOB RMSE", (" \ng cm"), as_sup("-2")))) |>
compose(part = "header", i = 2, j = 9,
value = c(as_paragraph("Test R", as_sup("2")))) |>
compose(part = "header", i = 2, j = 10,
value = c(as_paragraph("Test RMSE", (" \ng cm"), as_sup("-2")))) |>
compose(part = "body", i = 4, j = 1,
value = c(as_paragraph("SOC \n%"))) |>
compose(part = "body", i = 1, j = 1,
value = c(as_paragraph("SOC stock", "\ng cm", as_sup("-2")))) |>
fix_border_issues()
# vline(part = "header",  j = 9) |>
# delete_rows(i = c(2, 3), part = "body") |>
# delete_columns(j = 1) |>
# flextable::merge_h_range(i = 1, j1 = 1, j2 = 5, part = "header") |>
# flextable::merge_h_range(i = 1, j1 = 6, j2 = 8, part = "header") |>
# flextable::merge_h_range(i = 1, j1 = 9, j2 = 11, part = "header") |>
stat_table_format
saveRDS(stat_table_format, file = "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/Model_stats_table.rds")
readRDS(file = "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Tables/Model_stats_table.rds")
# Chunk 17: graph params
theme_param <- theme(
text = element_text(size = 8),
legend.position = 'right',
legend.key.size = unit(0.6, "cm"),
legend.spacing.x = unit(1.2, "cm"),
legend.text = element_text(size = rel(0.70), hjust = 0.5),
panel.background = element_blank(),
panel.grid.major = element_line(colour = "grey80", linewidth = 0.2),
axis.ticks = element_blank(),
axis.text = element_text(size = rel(0.8)),
axis.title = element_text(size = rel(1))
)
# Chunk 18
est_func <- function(data, coef_string){
if(str_detect(deparse(substitute(data)), "stocks")){
dat_type <- "stocks"
} else {
dat_type <- "lab"
}
coef <- data[data$Predictor == coef_string, "Coefficient"]
est_2.5 <- data[data$Predictor == coef_string, "conf2.5"]
est_97.5 <- data[data$Predictor == coef_string, "conf.975"]
est_string <- paste0("scaled coefficient estimate = ",
coef, " 95% CI: ",
est_2.5, " - ", est_97.5)
print(est_string)
saveRDS(est_string, paste0("/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/in_text_values/",
coef_string, "_", dat_type, "_est.rds"))
}
for(i in anova_ci_stocks$Predictor){
est_func(anova_ci_stocks, i)
#print(i)
}
for(i in anova_ci_lab$Predictor){
est_func(anova_ci_lab, i)
#print(i)
}
# Chunk 19
PNW_WIPimp_plot <- ggplot(allsite_WIPimp, aes(x = Predictor, y = MeanDecreaseAccuracy)) +
geom_col() +
facet_wrap(~ StudyArea) +
coord_flip() +
ylab("Mean Decrease Accuracy") +
theme_param
PNW_WIPimp_plot
saveRDS(PNW_WIPimp_plot, "/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/writing/Figures/PNW_WIPimp_plot.rds")
# Chunk 20
predict_plot <- function(model, data) {
mod_string <- tolower(deparse(substitute(model)))
if(str_detect(mod_string, pattern = "lmm")) {
fit_vals <- 10**predict(model, data, allow.new.levels = TRUE)
dep_var <- all.vars(formula(model))[1]
WIP_vals <- data$WIP*sd(train$WIP) + mean(train$WIP)
} else if(str_detect(mod_string, pattern = "rf")){
fit_vals <- predict(model, data)
dep_var <- model$model$dependent.variable.name
WIP_vals <- data$WIP
}
if(str_detect(dep_var, pattern = "carbon_perc")){
xlabel <- "Observed SOC (%)"
ylabel <- "Predicted SOC (%)"
axis_max <- floor(max(fit_vals, data[,1])*1.2)
} else if(str_detect(dep_var, pattern = "SOC_stock_spline")){
xlabel <- expression(Observed~SOC~g~cm^{"-2"})
ylabel <- expression(Predicted~SOC~g~cm^{"-2"})
axis_max <- floor(max(fit_vals, data[,1])*1.2)
}
#Graphing
predict_graph <- ggplot(data = data) +
geom_point(aes(y = fit_vals,
x = .data[[dep_var]],
fill = WIP_vals),
shape = 21, size = 3.5) +
geom_abline(intercept = 0, slope = 1) +
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(n = 9, name = "YlGnBu"),
values = c(-0.1,1.1), breaks = c(0.01, 0.5, 0.99),
labels = c("0%", "50%", "100%"),
name = "Wetland \nIntrinsic \nPotential",
) +
# annotate(geom = "text", x = axis_max/2, y = axis_max,
#          label = as.expression(bquote(R^2 == .(R2)))) +
ylab(ylabel) +
xlab(xlabel) +
xlim(0, axis_max) +
ylim(0, axis_max) +
theme_param
return(predict_graph)
}
lmm_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = 10**predict(lmm_lab, testlab_scale,
allow.new.levels = TRUE)), 2), nsmall = 2)
qrf_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = predict(QRFM_lab, testlab)), 2) , nsmall = 2)
lmm_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = 10**predict(lmm_lab, testlab_scale,
allow.new.levels = TRUE)), 2), nsmall = 2)
qrf_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = predict(QRFM_lab, testlab)), 2) , nsmall = 2)
predict(QRFM_lab, testlab)
QRFM_lab
testlab
lmm_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = 10**predict(lmm_lab, testlab_scale,
allow.new.levels = TRUE)), 2), nsmall = 2)
qrf_lab_r2 <- format(round(r.sq(y = testlab$carbon_perc,
y.fitted = predict(QRFM_lab, testlab)), 2) , nsmall = 2)
lmm_stocks_r2 <- format(round(r.sq(y = test_dat_scale$SOC_stock_spline,
y.fitted = 10**predict(lmm_stocks, test_dat_scale,
allow.new.levels = TRUE)), 2), nsmall = 2)
qrf_stocks_r2 <- format(round(r.sq(y = test$SOC_stock_spline,
y.fitted = predict(QRFM_stocks, test)), 2), nsmall = 2)
predict(QRFM_stocks, test)
predict(QRFM_stocks, test)
predict(QRFM_stocks, test)
QRFM_stocks <- readRDS(("/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/analysis/models/MLR3_RFM_Ranger_tuned.rds"))
QRFM_lab <- readRDS(("/Users/Anthony/OneDrive - UW/University of Washington/Data and Modeling/SOIL CARBON/All_WA/analysis/models/MLR3_RFM_Ranger_tuned_LabData.rds"))
QRFM_stocks
predict(QRFM_stocks)
